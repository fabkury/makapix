# ACL Rules for Makapix MQTT Broker
# Format: user <username> or pattern <pattern>
# Format: topic [read|write|readwrite] <topic>

# API Server - publish commands, read status, publish notifications
# Also: read player requests, write player responses
# Also: read player view events, write view acks
# Also: publish social notifications (reactions/comments)
user api-server
topic write makapix/player/+/command
topic read makapix/player/+/status
topic read makapix/player/+/request/+
topic write makapix/player/+/response/+
topic read makapix/player/+/view
topic write makapix/player/+/view/ack
topic write makapix/post/new/#
topic write makapix/post/new/user/#
topic write makapix/post/new/category/#
topic write makapix/social-notifications/#
topic read $SYS/#

# Registered players - use player_key (UUID) as MQTT username
# Pattern matching: %u matches the username (player_key)
pattern read makapix/player/%u/command
pattern write makapix/player/%u/status
pattern write makapix/player/%u/request/+
pattern read makapix/player/%u/response/#
pattern write makapix/player/%u/view
pattern read makapix/player/%u/view/ack

# Web clients - can only subscribe (read) to topics
# Username: webclient (shared password for all web browser clients)
user webclient
topic read makapix/post/new/user/#
topic read makapix/post/new/category/#
topic read makapix/social-notifications/#
topic read $SYS/#

# Default: deny all (this should be last)
topic read #
