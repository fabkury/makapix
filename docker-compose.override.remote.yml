# Docker Compose override for REMOTE development
# Uses existing caddy-docker-proxy for routing
services:
  # API service - routed via caddy-docker-proxy
  api:
    labels:
      caddy: dev.makapix.club
      caddy.@api.path: /api /api/*
      caddy.handle: "@api"
      caddy.handle.0_uri: strip_prefix /api
      caddy.handle.1_reverse_proxy: "{{upstreams 8000}}"
    ports: []  # Remove direct port binding - accessed via caddy-docker-proxy
    networks:
      - internal
      - caddy_net

  # Web service - routed via caddy-docker-proxy
  web:
    labels:
      caddy: dev.makapix.club
      caddy.reverse_proxy: "{{upstreams 3000}}"
      caddy.log.output: "file /var/log/caddy/dev-access.log"
      caddy.log.format: "json"
      caddy.log.level: "INFO"
    ports: []  # Remove direct port binding - accessed via caddy-docker-proxy
    networks:
      - internal
      - caddy_net

  # Disable the standalone proxy service for remote
  proxy:
    profiles:
      - disabled

networks:
  caddy_net:
    external: true

